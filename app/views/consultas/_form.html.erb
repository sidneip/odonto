<%= form_for(@consulta) do |f| %>
  <% if @consulta.errors.any? %>
      <h6><%= pluralize(@consulta.errors.count, "Erros encontrado(s) no formulario") %> </h6>

      <div class="alert alert-error">
        <a class="close" data-dismiss="alert">x</a>
      <% @consulta.errors.full_messages.each do |msg| %>
        <%= msg %>
        <br>
      <% end %>
    </div>
  <% end %>
  <% if action_name.include?('edit') %>
    <h5> Preencha os campos que deseja editar </h3>
  <%end%>
  <div class="field">
    <%= f.label :paciente_id %>
    <%= text_field_tag :paciente_nome %>
    <%= f.hidden_field :paciente_id %>
  </div>
  <div class="field">
    <%= f.label :data %>
    <%= f.text_field :data %>
  </div>
  <div class="field">
    <%= f.label :hora_inicio %>
    <%= f.text_field :hora_inicio%>
  </div>
  <div class="field">
    <%= f.label :hora_fim %>
    <%= f.text_field :hora_fim %>
  </div>
  <div class="field">
    <%= f.label :tipo %>
    <%= f.select(:tipo, ['Consulta', 'OrÃ§amento']) %>
  </div>
  <div class="field">
    <%= f.label :procedimento_id %>
    <%= text_field_tag :procedimento_nome %>
    <%= f.hidden_field :procedimento_id %>
  </div>
  <div class="field">
    <%= f.label :convenio_id %>
    <%= text_field_tag :convenio_nome %>
    <%= f.hidden_field :convenio_id %>
  </div>
  <div class="field">
    <%= f.label :dentista_id %>
    <%= text_field_tag :dentista_nome %>
    <%= f.hidden_field :dentista_id %>
  </div>
  <div class="field">
    <%= f.label :observacao %>
    <%= f.text_area :observacao %>
  </div>
  <div class="field">
    <%= f.label :status %>
    <%= f.select(:status, ['Marcada', 'Cancelada', 'Concluida']) %>
  </div>
  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>
<script>
  $(function() {
  $("#consulta_data").datepicker();
  $("#consulta_hora_inicio").mask('99:99');
  $("#consulta_hora_fim").mask('99:99');
      $.ajax({
      url: "../pacientes.xml",
      dataType: "xml",
      success: function( xmlResponse ) {
        var data = $( "paciente", xmlResponse ).map(function() {
          return {
            value: $( "nome", this ).text(),
            id: $( "id", this ).text()
          };
        }).get();
        $( "#paciente_nome" ).autocomplete({
          source: data,
          minLength: 0,
          select: function(event, ui) {
                $('#paciente_nome').val(ui.item.nome);
                $('#consulta_paciente_id').val(ui.item.id);
            },
        });
      }
    });
  });
  $.ajax({
      url: "../procedimentos.xml",
      dataType: "xml",
      success: function( xmlResponse ) {
        var data = $( "procedimento", xmlResponse ).map(function() {
          return {
            value: $( "nome", this ).text(),
            id: $( "id", this ).text()
          };
        }).get();
        $( "#procedimento_nome" ).autocomplete({
          source: data,
          minLength: 0,
          select: function(event, ui) {
                $('#procedimento_nome').val(ui.item.nome);
                $('#consulta_procedimento_id').val(ui.item.id);
            },
        });
      }
    });
  $.ajax({
      url: "../convenios.xml",
      dataType: "xml",
      success: function( xmlResponse ) {
        var data = $( "convenio", xmlResponse ).map(function() {
          return {
            value: $( "nome-fantasia", this ).text(),
            id: $( "id", this ).text()
          };
        }).get();
        $( "#convenio_nome" ).autocomplete({
          source: data,
          minLength: 0,
          select: function(event, ui) {
                $('#convenio_nome').val(ui.item.nome);
                $('#consulta_convenio_id').val(ui.item.id);
            },
        });
      }
    });
    $.ajax({
      url: "../dentistas.xml",
      dataType: "xml",
      success: function( xmlResponse ) {
        var data = $( "dentista", xmlResponse ).map(function() {
          return {
            value: $( "nome", this ).text(),
            id: $( "id", this ).text()
          };
        }).get();
        $( "#dentista_nome" ).autocomplete({
          source: data,
          minLength: 0,
          select: function(event, ui) {
                $('#dentista_nome').val(ui.item.nome);
                $('#consulta_dentista_id').val(ui.item.id);
            },
        });
      }
    });
  </script>
  <%= javascript_include_tag "mask" %>